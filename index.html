<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Royal Kingdom | Sovereign Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --royal-sky: #0ea5e9; --royal-grass: #22c55e; --royal-gold: #fbbf24; 
            --royal-red: #f43f5e; --royal-blue: #4f46e5; --royal-white: #ffffff;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Fredoka', sans-serif; margin: 0; background: var(--royal-sky); overflow: hidden; color: #1e293b; }

        /* --- ARKA PLAN VE ATMOSFER (PARALLAX) --- */
        .world { position: fixed; inset: 0; background: linear-gradient(180deg, #38bdf8 0%, #0ea5e9 40%, #22c55e 40%, #15803d 100%); z-index: -1; }
        .cloud { position: absolute; background: white; border-radius: 50px; opacity: 0.8; animation: moveCloud var(--d) infinite linear; }
        @keyframes moveCloud { from { left: -200px; } to { left: 120vw; } }

        /* --- √úST HUD (CAN, ALTIN, ELMAS) --- */
        .hud { position: fixed; top: 0; width: 100%; padding: 20px; z-index: 1000; }
        .hud-container { display: flex; justify-content: space-between; align-items: center; max-width: 600px; margin: 0 auto; }
        
        .resource-pill { 
            background: rgba(0,0,0,0.5); border: 3px solid rgba(255,255,255,0.4); 
            padding: 8px 15px; border-radius: 30px; color: white; display: flex; align-items: center; gap: 8px; font-weight: 700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .heart-count { color: var(--royal-red); font-size: 20px; text-shadow: 0 0 5px white; }
        .timer { font-size: 11px; opacity: 0.9; width: 40px; }

        /* --- KRALLIK SAHNESƒ∞ --- */
        .kingdom-view { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding-bottom: 120px; }
        .castle-base { position: relative; width: 320px; height: 320px; }
        .building-part { 
            position: absolute; bottom: 0; width: 100%; height: 100%; 
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateY(800px) scale(0); opacity: 0;
            filter: drop-shadow(0 20px 20px rgba(0,0,0,0.3));
        }
        .building-part.active { transform: translateY(0) scale(1); opacity: 1; }

        /* --- KONTROL PANELLERƒ∞ --- */
        .ui-panel { 
            position: fixed; bottom: 100px; width: 90%; max-width: 450px; left: 50%; transform: translateX(-50%); 
            z-index: 500; display: none;
        }
        .ui-panel.active { display: block; animation: slideUp 0.4s ease-out; }
        .royal-card { 
            background: white; border-radius: 40px; padding: 30px; text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); border-bottom: 12px solid #e2e8f0;
        }

        /* --- BUTONLAR (ROYAL STYLE) --- */
        .btn-play { 
            background: var(--royal-blue); color: white; border: none; padding: 22px; border-radius: 25px; 
            width: 100%; font-size: 24px; font-weight: 800; cursor: pointer;
            border-bottom: 8px solid #3730a3; transition: 0.1s; margin-bottom: 15px;
        }
        .btn-play:active { transform: translateY(4px); border-bottom-width: 4px; }
        .btn-gold { background: var(--royal-gold); color: #92400e; border-bottom-color: #d97706; }

        /* --- CAN YOK EKRANI --- */
        .shop-item { background: #f8fafc; border-radius: 20px; padding: 15px; display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }

        /* --- ALT NAVƒ∞GASYON --- */
        .nav-bar { 
            position: fixed; bottom: 0; width: 100%; height: 90px; background: white; 
            display: flex; justify-content: space-around; align-items: center; border-top: 5px solid #f1f5f9;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-icon { font-size: 35px; cursor: pointer; filter: grayscale(1); opacity: 0.4; transition: 0.3s; }
        .nav-icon.active { filter: grayscale(0); opacity: 1; transform: scale(1.3) translateY(-10px); }

        @keyframes slideUp { from { transform: translate(-50%, 200px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
    </style>
</head>
<body>

<div class="world">
    <div class="cloud" style="width:150px; height:50px; top:10%; --d:30s;"></div>
    <div class="cloud" style="width:200px; height:60px; top:20%; --d:45s; left:300px;"></div>
</div>

<div class="hud">
    <div class="hud-container">
        <div class="resource-pill" onclick="showLives()">
            <span class="heart-count">‚ù§Ô∏è</span>
            <span id="lives">5</span>
            <span class="timer" id="timer">FULL</span>
        </div>
        <div class="resource-pill">üí∞ <span id="coins">100</span></div>
        <div class="resource-pill">üíé <span id="gems">10</span></div>
    </div>
</div>

<div class="kingdom-view">
    <div class="castle-base">
        <div id="part0" class="building-part" style="font-size:200px; z-index:1;">ü™µ</div>
        <div id="part1" class="building-part" style="font-size:220px; z-index:2;">üß±</div>
        <div id="part2" class="building-part" style="font-size:250px; z-index:3;">üè∞</div>
        <div id="part3" class="building-part" style="font-size:100px; bottom:250px; left:110px; z-index:4;">üö©</div>
    </div>
</div>

<div id="panel-castle" class="ui-panel active">
    <div class="royal-card">
        <h2 id="b-title" style="margin:0">Yeni B√∂l√ºm</h2>
        <p id="b-desc" style="color:#64748b">Krallƒ±ƒüƒ±nƒ± b√ºy√ºtmek i√ßin in≈üaata ba≈üla!</p>
        <button id="btn-b" class="btn-play" onclick="handleBuild()">ƒ∞n≈üa Et (üí∞ <span id="b-cost">50</span>)</button>
    </div>
</div>

<div id="panel-mine" class="ui-panel">
    <div class="royal-card">
        <h2>Altƒ±n Topla</h2>
        <p style="color:#64748b">Her kazma 1 Can ‚ù§Ô∏è g√∂t√ºr√ºr!</p>
        <button class="btn-play btn-gold" onclick="handleMine()">MADENE Gƒ∞R (-1 ‚ù§Ô∏è)</button>
    </div>
</div>

<div id="panel-lives" class="ui-panel">
    <div class="royal-card">
        <h2 style="color:var(--royal-red)">CANIN Bƒ∞TTƒ∞!</h2>
        <p style="color:#64748b">Bekleme, hemen oyuna d√∂n!</p>
        <div class="shop-item">
            <span>FULL CAN ‚ù§Ô∏è</span>
            <button class="btn-play btn-gold" style="width:auto; padding:10px 20px; font-size:16px;" onclick="buyLives()">üíé 5</button>
        </div>
        <button class="btn-play" style="background:#94a3b8; border-bottom-color:#64748b; font-size:16px; margin-top:15px;" onclick="closeLives()">BEKLEYECEƒûƒ∞M</button>
    </div>
</div>

<nav class="nav-bar">
    <div class="nav-icon active" onclick="tab('castle', this)">üè∞</div>
    <div class="nav-icon" onclick="tab('mine', this)">‚öíÔ∏è</div>
</nav>

<script>
    // --- OYUN DURUMU VE BELLEK ---
    let state = JSON.parse(localStorage.getItem('royal_v2_data')) || {
        coins: 100, gems: 10, lives: 5, step: 0, lastRegen: Date.now()
    };

    const config = [
        { name: "K√∂y Meydanƒ±", cost: 50 },
        { name: "Y√ºksek Surlar", cost: 150 },
        { name: "Kraliyet Kulesi", cost: 400 },
        { name: "Zafer Bayraƒüƒ±", cost: 1000 }
    ];

    const REGEN_TIME = 30; // Test i√ßin 30 saniye. Ger√ßek i√ßin 300 yap.

    function save() {
        localStorage.setItem('royal_v2_data', JSON.stringify(state));
        updateHUD();
    }

    // --- CAN Sƒ∞STEMƒ∞ (TICKER) ---
    function updateHUD() {
        let now = Date.now();
        let passed = Math.floor((now - state.lastRegen) / 1000);

        if (state.lives < 5) {
            if (passed >= REGEN_TIME) {
                let add = Math.floor(passed / REGEN_TIME);
                state.lives = Math.min(5, state.lives + add);
                state.lastRegen = now - (passed % REGEN_TIME) * 1000;
            }
            let remain = REGEN_TIME - (passed % REGEN_TIME);
            document.getElementById('timer').innerText = "00:" + (remain < 10 ? "0" : "") + remain;
        } else {
            document.getElementById('timer').innerText = "FULL";
        }

        document.getElementById('lives').innerText = state.lives;
        document.getElementById('coins').innerText = state.coins;
        document.getElementById('gems').innerText = state.gems;

        // ƒ∞n≈üaat durumu
        config.forEach((c, i) => {
            if(state.step > i) document.getElementById('part'+i).classList.add('active');
        });

        if(state.step < config.length) {
            document.getElementById('b-title').innerText = config[state.step].name;
            document.getElementById('b-cost').innerText = config[state.step].cost;
        } else {
            document.getElementById('b-title').innerText = "Efsanevi Krallƒ±k!";
            document.getElementById('btn-b').disabled = true;
            document.getElementById('btn-b').innerText = "TAMAMLANDI";
        }
    }

    // --- AKSƒ∞YONLAR ---
    function handleMine() {
        if (state.lives > 0) {
            state.lives--;
            state.coins += 25;
            if (state.lives === 4) state.lastRegen = Date.now();
            save();
            alert("Altƒ±n Kazandƒ±n! üí∞");
        } else {
            showLives();
        }
    }

    function handleBuild() {
        let cost = config[state.step].cost;
        if (state.coins >= cost) {
            state.coins -= cost;
            state.step++;
            save();
        } else {
            alert("Yeterli altƒ±nƒ±n yok! Madene gir.");
        }
    }

    function buyLives() {
        if (state.gems >= 5) {
            state.gems -= 5;
            state.lives = 5;
            save();
            closeLives();
        }
    }

    // --- UI Y√ñNETƒ∞Mƒ∞ ---
    function tab(type, el) {
        document.querySelectorAll('.ui-panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-icon').forEach(n => n.classList.remove('active'));
        document.getElementById('panel-' + type).classList.add('active');
        el.classList.add('active');
    }

    function showLives() {
        document.querySelectorAll('.ui-panel').forEach(p => p.classList.remove('active'));
        document.getElementById('panel-lives').classList.add('active');
    }

    function closeLives() {
        document.getElementById('panel-lives').classList.remove('active');
        document.getElementById('panel-castle').classList.add('active');
        document.querySelector('.nav-icon').classList.add('active');
    }

    setInterval(updateHUD, 1000);
    save();
</script>
</body>
</html>
